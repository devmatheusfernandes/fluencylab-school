# Implementation Plan: Fix Student Profile Missing Information

I will update the Student Profile Details Page to calculate and display age from birth date and populate phone number and city from the associated User object if available. I will also update the Survey form to auto-populate these fields from the logged-in user's profile and save them correctly.

## 1. Update `StudentProfileDetailsPage`

* **Logic**:

  * Calculate `age` from `user.birthDate` if `profile.age` is missing.

  * Use `user.phoneNumber` if `profile.phoneNumber` is missing.

  * Use `user.address.city` if `profile.city` is missing.

  * Use `user.email` if `profile.email` is missing.

* **File**: `app/[locale]/hub/manager/student-profiles/[id]/page.tsx`

* **Implementation**: Update the variable assignment logic before rendering the JSX.

## 2. Update `StudentProfileSurvey`

* **Logic**:

  * When initializing `formData`, check if `initialData` (which comes from `profile`) has these fields.

  * If not, try to fetch the current user's data (since the student is likely logged in filling this out) to pre-fill the form.

  * However, the `StudentProfileSurvey` component receives `initialData` as a prop. The fetching logic should likely happen in the *parent* component (the page that renders the survey) or via a `useEffect` inside the survey if we want to fetch user details.

  * A better approach: The `BasicInfoStep` should populate defaults from the User object if `formData` is empty.

  * But wait, `StudentProfileSurvey` is likely used by the student.

  * I will check `app/[locale]/hub/student/profile/page.tsx` (or where the survey is hosted) to see if we can pass User data to `StudentProfileSurvey`.

## 3. Update `BasicInfoStep`

* **Logic**:

  * Add logic to calculate Age from Birth Date dynamically in the UI (or just rely on the backend/save logic).

  * The survey saves `birthDate`. The `StudentProfile` type has `age`. We should probably calculate `age` on the server when saving, OR just calculate it on display. Storing `age` is redundant if we have `birthDate`.

  * **Decision**: I will update the display logic to calculate age on the fly, but I will also ensure `birthDate` is saved correctly.

## 4. Refactoring `StudentProfileDetailsPage` Display

* Instead of relying solely on `profile.age`, `profile.phoneNumber`, etc., I will create a `displayData` object that merges `profile` data with `user` data.

## Verification

* Verify that `age` is calculated from `birthDate` in the profile view.

* Verify that `phoneNumber` and `city` appear if the user has them in their contract/account.

