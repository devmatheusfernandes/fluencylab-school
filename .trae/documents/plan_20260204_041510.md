# Implementar Login com Google (Associado a Contas Existentes)

Este plano detalha a implementação do login social com Google, permitindo que usuários já cadastrados no sistema acessem suas contas usando suas credenciais do Google. Além disso, gerencia o estado de usuários sem senha (login exclusivo via Google).

## 1. Backend e Configuração do NextAuth

### Arquivo: `types/next-auth.d.ts`

* Adicionar a propriedade `hasPassword?: boolean` às interfaces `User` e `Session`.

### Arquivo: `services/core/authService.ts`

* Atualizar `getUserById` (ou criar método auxiliar) para verificar no Firebase Auth (`adminAuth.getUser`) se o usuário possui o provider `password` em `providerData`.

* Retornar o status `hasPassword` junto com os dados do usuário.

### Arquivo: `app/api/auth/[...nextauth]/route.ts`

* **Configuração:** Adicionar `GoogleProvider` à lista de provedores.

* **Callback** **`signIn`:**

  * Verificar se o e-mail do Google já existe na coleção `users` do Firestore.

  * Se existir, permitir o login.

  * Se não existir, bloquear o acesso.

* **Callback** **`jwt`:**

  * Ao logar com Google, buscar o usuário no Firestore.

  * Sobrescrever `token.id` com o ID do Firestore.

  * Persistir a flag `hasPassword` no token e na sessão.

## 2. Frontend - Telas de Acesso

### Tela de Login (`SignInClient.tsx`)

* Adicionar divisor "Ou" e botão "Entrar com Google".

* Configurar ação de login social.

### Tela de Criação de Senha (`CreatePassword.tsx`)

* Adicionar botão "Entrar com Google".

* **Comportamento:** Se o usuário escolher Google, ele pula a criação de senha e loga diretamente (pois a conta já existe).

## 3. Frontend - Configurações (`SettingsForm.tsx`)

* Ler a propriedade `session.user.hasPassword`.

* **Condicional:** Se o usuário **NÃO** tiver senha (`!hasPassword`):

  * Exibir um novo cartão "Segurança" (ou seção específica).

  * Mostrar mensagem: "Você acessa com Google. Defina uma senha para acessar também com email/senha."

  * Botão de ação: "Definir Senha" -> Dispara o envio do e-mail de redefinição de senha (mesmo fluxo do "Esqueci minha senha"), permitindo que ele crie uma senha segura.

## 4. Traduções (i18n)

* Adicionar chaves para os novos botões, divisores e mensagens de erro/status em `pt.json` e `en.json`.

