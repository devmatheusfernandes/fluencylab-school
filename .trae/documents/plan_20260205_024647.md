# Implementation Plan: Fix Integration Progress and Placement Logic

I will update the `IntegrationProgress` component to correctly verify the placement test completion by checking the `placement_results` collection, enable checkboxes for all items (but disable interaction for automatic ones), and remove the unused code snippet.

## 1. Fix Placement Logic

* **Problem**: The current logic checks `profile.level`, but the user states the results are in `placement_results` collection.

* **Solution**:

  * I need to check if a placement test result exists for the user.

  * Since `IntegrationProgress` is a client component, I should pass this "hasPlacement" boolean as a prop from the server component (`page.tsx`).

  * In `page.tsx`, I will query the `placement_results` collection (or use `placementRepository` if updated) to check for existence.

  * *Correction*: The `placementRepository` currently looks at `users/{userId}/Placement`. I should verify if `placement_results` is the correct collection as per the user's instruction and the search results (`app/[locale]/hub/student/my-placement/test/page.tsx` saves to `placement_results`).

  * I will update `placementRepository` to include a method `hasCompletedPlacement(userId: string)` that checks `placement_results`.

## 2. Update Checkbox Logic

* **Problem**: Automatic steps render a static icon, while manual steps render a checkbox. The user wants checkboxes for *all* steps, but automatic ones should be disabled (read-only).

* **Solution**:

  * Update the `steps.map` loop in `IntegrationProgress.tsx`.

  * Instead of the conditional rendering `step.manual ? <Checkbox ... /> : <div ... />`, I will always render a `<Checkbox />`.

  * For automatic steps (`!step.manual`), the Checkbox will have `disabled={true}` and `checked={step.checked}`.

  * For manual steps, it remains interactive.

## 3. Remove Unused Code

* **Problem**: The variable `isNext` is calculated but not used.

* **Solution**: Remove the line `const isNext = !isCompleted && (index === 0 || steps[index - 1].checked);`.

## 4. Implementation Steps

1. **Update** **`PlacementRepository`**: Add `hasCompletedPlacement(userId)` method querying `placement_results`.
2. **Update** **`StudentProfileDetailsPage`**: Fetch the placement status using the new repository method and pass it to `IntegrationProgress`.
3. **Update** **`IntegrationProgress`** **Component**:

   * Accept `hasPlacement` as a prop.

   * Update the "Aluno fez nivelamento" step logic to use `hasPlacement`.

   * Refactor the rendering to use Checkboxes for all steps.

   * Remove unused `isNext` variable.

## Verification

* Verify that "Aluno fez nivelamento" is checked if the user has a document in `placement_results`.

* Verify that all steps show checkboxes.

* Verify that automatic steps are not clickable.

