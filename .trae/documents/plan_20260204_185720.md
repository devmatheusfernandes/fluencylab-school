# Refatoração do Fluxo de Perfis de Alunos

Este plano detalha a migração dos perfis de alunos para uma coleção raiz, permitindo perfis "soltos" e a implementação de um novo fluxo de criação estilo "Survey".

## 1. Backend e Tipos

### 1.1 Atualização de Tipos (`types/students/studentProfile.ts`)

* Refatorar a interface `StudentProfile` para corresponder exatamente ao questionário do `perfil.md`.

* Tornar `studentId` (antigo `userId`) opcional.

* Adicionar campos para todas as seções (Histórico, Objetivos, Disponibilidade, Profissional, Interesses, Estilo de Aprendizagem, Dificuldades, Expectativas).

### 1.2 Server Actions (`actions/studentProfile.ts`)

* **Alterar Persistência**: Mudar o salvamento de `users/{id}/studentProfile` para a coleção raiz `student-profiles`.

* **Remover Sincronização**: Remover a lógica que atualizava o documento do `User` (telefone, endereço), conforme solicitado.

* **Novas Funções**:

  * `createStudentProfile(data)`: Cria um novo perfil (retorna ID).

  * `updateStudentProfile(id, data)`: Atualiza um perfil existente.

  * `getStudentProfiles()`: Busca todos os perfis para a listagem.

  * `getStudentProfileById(id)`: Busca um perfil específico.

  * `associateStudentProfile(profileId, studentId)`: Vincula um perfil a um aluno.

## 2. Frontend - Componentes de UI

### 2.1 Novo Formulário "Survey" (`components/students/survey/`)

* Criar componente `StudentProfileSurvey` que gerencia o estado multi-etapas.

* **Persistência Local**: Implementar hook `useLocalStorage` para salvar o progresso automaticamente (prevenindo perda de dados).

* **Design**:

  * Layout focado e limpo (estilo Typeform).

  * Barra de progresso no topo.

  * Navegação "Anterior/Próximo".

  * Responsivo para mobile (botões grandes, inputs fáceis de tocar).

* **Seções** (baseado em `perfil.md`):

  1. Identificação (Nome, Data Nasc., Profissão)
  2. Histórico com o idioma
  3. Objetivos e Motivação
  4. Disponibilidade
  5. Contexto Profissional
  6. Interesses
  7. Estilo de Aprendizagem
  8. Dificuldades
  9. Preferências e Expectativas

### 2.2 Modal de Associação (`components/students/AssociateStudentModal.tsx`)

* Modal que recebe um `profileId`.

* Contém um `Combobox` (Search) para selecionar alunos existentes (filtrados por role `student`).

* Ao salvar, chama a action `associateStudentProfile`.

## 3. Frontend - Páginas

### 3.1 Listagem de Perfis (`app/[locale]/hub/manager/student-profiles/page.tsx`)

* Substituir a página atual.

* Exibir os perfis em **Cards** (melhor para mobile e visualização rápida).

* Cada card mostrará:

  * Nome do Aluno (ou do Perfil).

  * Status de Associação (Vinculado/Solto).

  * Resumo (Nível, Objetivo).

  * Botão "Editar" (vai para o Survey).

  * Botão "Associar Aluno" (abre o Modal - apenas se estiver solto).

* Botão flutuante ou no cabeçalho para "Novo Perfil".

### 3.2 Criação e Edição

* `app/[locale]/hub/manager/student-profiles/create/page.tsx`: Renderiza o Survey vazio.

* `app/[locale]/hub/manager/student-profiles/[id]/page.tsx`: Renderiza o Survey preenchido com dados do servidor.

## 4. Traduções (i18n)

* Adicionar todas as perguntas e opções do questionário aos arquivos `messages/pt.json` e `en.json` sob o namespace `StudentProfileSurvey`.

